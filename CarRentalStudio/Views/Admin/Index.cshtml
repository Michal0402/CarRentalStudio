@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="manage-sections">
    <!-- Przycisk do zarządzania samochodami -->
    <button class="btn btn-primary" id="manageCarsBtn">Manage Cars</button>

    <!-- Przycisk do zarządzania użytkownikami -->
    <button class="btn btn-primary" id="manageUsersBtn">Manage Users</button>

    <!-- Przycisk do zarządzania rezerwacjami -->
    <button class="btn btn-primary" id="manageRentalsBtn">Manage Rentals</button>
</div>

<!-- Sekcja na dane, które się zmieniają po kliknięciu w jeden z przycisków -->
<div id="dataContainer">
    <!-- Tutaj będą wyświetlane odpowiednie listy (np. Cars, Users, Rentals) -->
</div>

@section Scripts {
    <script>
        // Załaduj listy (samochody, użytkownicy, rezerwacje)
        $(document).ready(function () {
            // Obsługa przycisku "Manage Cars"
            $('#manageCarsBtn').click(function () {
                $('#dataContainer').load('@Url.Action("Cars", "Admin")');
            });

            // Obsługa przycisku "Manage Users"
            $('#manageUsersBtn').click(function () {
                $('#dataContainer').load('@Url.Action("Clients", "Admin")');
            });

            // Obsługa przycisku "Manage Rentals"
            $('#manageRentalsBtn').click(function () {
                $('#dataContainer').load('@Url.Action("Rentals", "Admin")');
            });

            // Obsługa kliknięcia w link "Add Car"
            $(document).on('click', '#add-car-link', function (e) {
                e.preventDefault(); // Zapobiega przeładowaniu strony

                // Wywołanie żądania GET do kontrolera Admin/CreateCar
                $.get('@Url.Action("CreateCar", "Admin")', function (data) {
                    $('#dataContainer').html(data); // Załaduj formularz do kontenera
                }).fail(function () {
                    alert("Failed to load the form. Please try again.");
                });
            });

            // Obsługa wysyłania formularza dodawania samochodu
            $(document).on('submit', '#carCreateForm', function (e) {
                e.preventDefault(); // Zapobiega przeładowaniu strony
                const form = $(this);

                // Wysłanie formularza jako POST
                $.post(form.attr('action'), form.serialize(), function (response) {
                    // Po dodaniu samochodu, załaduj zaktualizowaną tabelę samochodów
                    $.get('@Url.Action("Cars", "Admin")', function (data) {
                        $('#dataContainer').html(data); // Załaduj listę samochodów po dodaniu
                    }).fail(function () {
                        alert("Failed to load updated car list.");
                    });
                }).fail(function (response) {
                    // Jeśli formularz nie przeszedł walidacji, wyświetl błędy
                    const errors = response.responseJSON;
                    let errorMessages = '';
                    for (const field in errors) {
                        if (errors.hasOwnProperty(field)) {
                            errorMessages += errors[field].join('<br/>');
                        }
                    }
                    alert("There were errors:\n" + errorMessages);
                });
            });
        });

        // Edycja samochodu
        $(document).on("click", ".edit-car-link", function (e) {
            e.preventDefault();
            const url = $(this).attr("href");

            $.get(url, function (data) {
                $("#dataContainer").html(data); // Załaduj formularz edycji
            }).fail(function () {
                alert("Failed to load the edit form. Please try again.");
            });
        });

        $(document).on("submit", "#carEditForm", function (e) {
            e.preventDefault();
            const form = $(this);

            $.post(form.attr("action"), form.serialize(), function (response) {
                $("#dataContainer").html(response); // Załaduj zaktualizowaną listę
            }).fail(function () {
                alert("Failed to save changes. Please try again.");
            });
        });

        // Usuwanie samochodu
        $(document).on("click", ".delete-car-link", function (e) {
            e.preventDefault();
            if (!confirm("Are you sure you want to delete this car?")) {
                return;
            }

            const url = $(this).attr("href");

            $.post(url, function (response) {
                $("#dataContainer").html(response); // Załaduj zaktualizowaną listę
            }).fail(function () {
                alert("Failed to delete the car. Please try again.");
            });
        });
    </script>
}


